{% load static %}
{% load my_tags %}

<div class="comment-row" id="commentArticle">
    <h2 class="mb-4">({{ comments.count }}) Комментарии</h2>
    <ul style="list-style-type:none;">
        <div class="col-md-12 mt-2" id="CommentList">
            {% for comment in comments %}
                {% if comment.parent == Null %}
                    <li class="li-reply-comment">
                        <div class="main-comment-section col-md-12" id='CommentId-{{ comment.id }}'>
                            <div>
                                <a href="{% url 'articles:author_profile' comment.author.id %}"
                                   class="post-author comment-author">
                                    <img src="{{ comment.author.habruserprofile.avatar|media_folder_users }}"
                                         alt=""/>
                                    <small>{{ comment.author }}</small>
                                </a>
                                <span>{{ comment.date }}</span>
                            </div>
                            <div class="comment-text">
                                <div>{{ comment.body }}</div>
                            </div>
                            <span class='reply reply-comment' data-id="{{ comment.id }}">Ответить</span>
                            <form method="POST" class="comment-form" id="createChildCommentForm-{{ comment.id }}"
                                  data-url="{% url 'comments:comment_child_create' pk=article.id id_parent_comment=comment.id %}"
                                  style="display:none;">
                                {% csrf_token %}
                                {{ form_comment.as_p }}
                                {% if request.user.is_authenticated %}
                                    <input type="submit" value="Отправить" class="btn btn-outline-success">
                                    </form>
                                {% else %}
                                    <button class="btn btn-outline-success"><a
                                            href="{% url 'auth:login' %}">Отправить</a></button>
                                {% endif %}
{#                            <button type="button" data-id="{{ comment.id }}"#}
{#                                    class="btn btn-outline-success createCommentChildBtn">Отправить#}
{#                            </button>#}
                            </form>
                            <div class="post-status">
                                {% if comment.id in comments_is_liked %}
                                    <img src="{% static 'svg/like(filled).svg' %}" alt="" id="like-{{ comment.id }}"
                                         class="comment_like"/>
                                {% else %}
                                    <img src="{% static 'svg/like.svg' %}" alt="" id="like-{{ comment.id }}"
                                         class="comment_like"/>
                                {% endif %}
                                <small class="green" id="likes{{ comment.id }}">{{ comment.likes.count }}</small>
                                {% if comment.id in comments_is_disliked %}
                                    <img src="{% static 'svg/dislike(filled).svg' %}" alt=""
                                         id="dislike-{{ comment.id }}" class="comment_dislike"/>
                                {% else %}
                                    <img src="{% static 'svg/dislike.svg' %}" alt="" id="dislike-{{ comment.id }}"
                                         class="comment_dislike"/>
                                {% endif %}
                                <small class="red" id="dislikes{{ comment.id }}">{{ comment.dislikes.count }}</small>
                            </div>
                            {% include 'comments/includes/inc_tree_comments.html' %}
                        </div>
                    </li>
                {% endif %}
            {% endfor %}
        </div>
    </ul>
</div>
<div class="container-fluid mt-2">
    <form method="POST" class="comment-form" id="createCommentForm"
          data-url="{% url 'comments:comment_create' pk=article.id %}">
        {% csrf_token %}
        {{ form_comment.as_p }}
        <button type="button" id="createCommentBtn" class="btn btn-outline-success">Отправить</button>
    </form>
</div>
{% block css %}
    <link href="{% static 'css/comments.css' %}" rel="stylesheet"/>
{% endblock css %}
{#{% block js %}#}
{#    <script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>#}
{#    {% if request.user.is_authenticated %}#}
{#        <script>#}
{#            function sendCommentAjax(fieldName, id) {#}
{#                $.ajax({#}
{#                    data: {field: fieldName, comment: id},#}
{#                    url: "{% url 'comments:ajax_comment' %}",#}
{#                    success: function (response) {#}
{#                        $("#likes" + response.id).text(response.likes)#}
{#                        $("#dislikes" + response.id).text(response.dislikes)#}
{#                        if (response.like === true) {#}
{#                            $('#like-' + response.id).attr('src', likeFUrl);#}
{#                        } else {#}
{#                            $('#like-' + response.id).attr('src', likeUrl);#}
{#                        }#}
{#                        if (response.dislike === true) {#}
{#                            $('#dislike-' + response.id).attr('src', dislikeFUrl);#}
{#                        } else {#}
{#                            $('#dislike-' + response.id).attr('src', dislikeUrl);#}
{#                        }#}
{#                    }#}
{#                });#}
{#            };#}
{##}
{#            $(document).ready(function () {#}
{#                $('.comment_like').click(function () {#}
{#                    sendCommentAjax('like', $(this).attr('id'))#}
{#                    if ($(this).attr('src') == likeFUrl) {#}
{#                        $(this).attr('src', likeUrl);#}
{#                    } else {#}
{#                        $(this).attr('src', likeFUrl);#}
{#                    }#}
{#                });#}
{##}
{#                $('.comment_dislike').click(function () {#}
{#                    sendCommentAjax('dislike', $(this).attr('id'))#}
{#                    if ($(this).attr('src') == dislikeFUrl) {#}
{#                        $(this).attr('src', dislikeUrl);#}
{#                    } else {#}
{#                        $(this).attr('src', dislikeFUrl);#}
{#                    }#}
{#                });#}
{#            });#}
{#        </script>#}
{#    {% else %}#}
{#        <script>#}
{#            $(document).ready(function () {#}
{#                $('#like').hover(function () {#}
{#                    $(this).attr('src', likeFUrl);#}
{#                }, function () {#}
{#                    $(this).attr('src', likeUrl);#}
{#                });#}
{#                $('#dislike').hover(function () {#}
{#                    $(this).attr('src', dislikeFUrl);#}
{#                }, function () {#}
{#                    $(this).attr('src', dislikeUrl);#}
{#                });#}
{#                $('#bookmark').hover(function () {#}
{#                    $(this).attr('src', bookmarkFUrl);#}
{#                }, function () {#}
{#                    $(this).attr('src', bookmarkUrl);#}
{#                });#}
{##}
{#                $('#like').click(function () {#}
{#                    window.location.replace('{% url 'auth:login' %}')#}
{#                });#}
{##}
{#                $('#dislike').click(function () {#}
{#                    window.location.replace('{% url 'auth:login' %}')#}
{#                });#}
{##}
{#                $('#bookmark').click(function () {#}
{#                    window.location.replace('{% url 'auth:login' %}')#}
{#                });#}
{#            });#}
{#        </script>#}
{#    {% endif %}#}
    {#   скрипт комментариев   #}
{#    <script>#}
{#        $(document).ready(function () {#}
{#            $(".reply").on('click', function () {#}
{#                var parentId = $(this).attr('data-id')#}
{#                $("#createChildCommentForm-" + parentId).fadeToggle();#}
{#            });#}
{##}
{#            $('#createCommentBtn').click(function (e) {#}
{#                if ('{{ request.user.is_authenticated }}' == 'False') {#}
{#                    let url = "/auth/login/";#}
{#                    $(location).attr('href', url);#}
{#                }#}
{#                ;#}
{#                e.preventDefault()#}
{#                let content = $('#createCommentForm').serialize();#}
{##}
{#                $.ajax({#}
{#                    url: $("#createCommentForm").data('url'),#}
{#                    data: content,#}
{#                    type: 'POST',#}
{#                    success: function (response) {#}
{#                        $('.comment-form').trigger("reset");#}
{#                        location.reload();#}
{##}
{#                    }#}
{#                })#}
{#            })#}
{##}
{#            $('#createCommentForm')[0].reset();#}
{##}
{#            $('.createCommentChildBtn').click(function (e) {#}
{#                if ('{{ request.user.is_authenticated }}' == 'False') {#}
{#                    let url = "/auth/login/";#}
{#                    $(location).attr('href', url);#}
{#                }#}
{#                ;#}
{#                e.preventDefault()#}
{#                let id = $(this).attr('data-id')#}
{#                let content = $('#createChildCommentForm-' + id).serialize();#}
{##}
{#                $.ajax({#}
{#                    url: $('#createChildCommentForm-' + id).data('url'),#}
{#                    data: content,#}
{#                    type: 'POST',#}
{#                    success: function (response) {#}
{#                        $('.comment-form').trigger("reset");#}
{#                        location.reload();#}
{#                    }#}
{#                })#}
{#            });#}
{#        });#}
{#    </script>#}
{#{% endblock js %}#}
