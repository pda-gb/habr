{% load static %}
{% load my_tags %}

<h2 class="mb-4">({{ comments.count }}) Комментарии</h2>
        <ul style="list-style-type:none;">
            <div class="col-md-12 mt-2" id="CommentList">
                {% for comment in comments %}
                    {% if comment.parent == Null %}
                        <li class="li-reply-comment">
                            <div class="main-comment-section col-md-12" id='CommentId-{{ comment.id }}'>
                                <div>
                                    <a href="{% url 'articles:author_profile' comment.author.id %}"
                                       class="post-author comment-author">
                                        <img src="{{ comment.author.habruserprofile.avatar|media_folder_users }}"
                                             alt=""/>
                                        <small>{{ comment.author }}</small>
                                    </a>
                                    <span>{{ comment.date }}</span>
                                </div>
                                <div class="comment-text">
                                    <div>{{ comment.body }}</div>
                                </div>
                                <span class='reply reply-comment' data-id="{{ comment.id }}">Ответить</span>
                                <form method="POST" class="comment-form" id="createChildCommentForm-{{ comment.id }}" data-url="{% url 'comments:comment_child_create' pk=article.id id_parent_comment=comment.id %}" style="display:none;">
                                    {% csrf_token %}
                                    {{ form_comment.as_p }}
                                    <button type="button" class="btn btn-outline-success createCommentChildBtn" data-id="{{ comment.id }}">Отправить</button>
                                </form>
                                {% include 'comments/includes/inc_tree_comments.html' %}        
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
            </div>
        </ul>
        <script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>
        <script>
            $(document).ready(function(){
                $(".reply").on('click', function(){
                    var parentId = $(this).attr('data-id')
                    $("#createChildCommentForm-"+parentId).fadeToggle();
                });

                $('#createCommentBtn').click(function(e) {
                    e.preventDefault()
                    let content = $('#createCommentForm').serialize();
            
                    $.ajax({
                        url: $("#createCommentForm").data('url'),
                        data: content,
                        type: 'POST',
                        success: function(response) {
                            $('#commentArticle').html(response.result);
                        }
                    })
                })

                $('#createCommentForm')[0].reset();
                
                $('.createCommentChildBtn').click(function(e) {
                    e.preventDefault()
                    let id = $(this).attr('data-id')
                    let content = $('#createChildCommentForm-' + id).serialize();

                    $.ajax({
                        url: $('#createChildCommentForm-' + id).data('url'),
                        data: content,
                        type: 'POST',
                        success: function(response) {
                            $('#commentArticle').html(response.result);
                        }
                    })
                });
            });
        </script>